{
  "info": {
    "name": "Identity Service - Automated Tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "identity-service-collection-2025-11-23"
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register (Self) - Happy Path",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{newUserUsername}}\",\n  \"email\": \"{{newUserUsername}}@example.com\",\n  \"password\": \"{{newUserPassword}}\",\n  \"firstName\": \"Test\",\n  \"lastName\": \"User\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201 or 200', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var json = pm.response.json();",
                  "    pm.collectionVariables.set('userId', json.id);",
                  "    console.log('Registered user ID: ' + json.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Register Duplicate - Error",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{newUserUsername}}\",\n  \"email\": \"{{newUserUsername}}@example.com\",\n  \"password\": \"{{newUserPassword}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Duplicate register returns 4xx', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 409]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Admin Login (seeded admin)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{adminUsername}}\",\n  \"password\": \"{{adminPassword}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Admin login returns 200', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('adminToken', json.accessToken);",
                  "pm.collectionVariables.set('adminRefreshToken', json.refreshToken);",
                  "console.log('Saved adminToken');"
                ]
              }
            }
          ]
        },
        {
          "name": "Login Registered User",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{newUserUsername}}\",\n  \"password\": \"{{newUserPassword}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('User login returns 200', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('userToken', json.accessToken);",
                  "pm.collectionVariables.set('userRefreshToken', json.refreshToken);",
                  "console.log('Saved userToken');"
                ]
              }
            }
          ]
        },
        {
          "name": "Refresh Token - Happy Path",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": "{{baseUrl}}/auth/refresh",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{userRefreshToken}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Refresh returns 200 or 400 for invalid token', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 400, 401, 403]);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Admin - Utilities",
      "item": [
        {
          "name": "Get Admin User & Role IDs (Auto detect)",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/users?page=0&size=100"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get all users returns 200', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "});",
                  "var json = pm.response.json();",
                  "var users = json.content || json;",
                  "if (users && users.length) {",
                  "    for (var i = 0; i < users.length; i++) {",
                  "        if (users[i].username === pm.collectionVariables.get('adminUsername')) {",
                  "            pm.collectionVariables.set('adminUserId', users[i].id);",
                  "            break;",
                  "        }",
                  "    }",
                  "}",
                  "// Attempt to find the ADMIN role",
                  "pm.sendRequest({",
                  "    url: pm.collectionVariables.get('baseUrl') + '/admin/roles?page=0&size=100',",
                  "    method: 'GET',",
                  "    header: { 'Authorization': 'Bearer ' + pm.collectionVariables.get('adminToken') }",
                  "}, function (err, res) {",
                  "    if (!err && res && res.code === 200) {",
                  "        var roles = res.json().content || res.json();",
                  "        roles.forEach(function(r) {",
                  "            if (r.name === 'ADMIN') {",
                  "                pm.collectionVariables.set('adminRoleId', r.id);",
                  "            }",
                  "        });",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Admin - Roles",
      "item": [
        {
          "name": "Create Role - Happy Path",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/admin/roles",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"CONTENT_MODERATOR\",\n  \"description\": \"Can moderate user generated content\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Create role returns 201', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('roleId', json.id);",
                  "console.log('Saved roleId: ' + json.id);"
                ]
              }
            }
          ]
        },
        {
          "name": "Create Role - Duplicate",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/admin/roles",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"CONTENT_MODERATOR\",\n  \"description\": \"Duplicate role test\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Create duplicate role returns 4xx', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 409]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Create Role - Invalid Name",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/admin/roles",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"invalid name!\",\n  \"description\": \"Invalid name test\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Invalid role name returns 400', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Create Role - Attempt as non-admin (should be denied)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{userToken}}" }
            ],
            "url": "{{baseUrl}}/admin/roles",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"USER_TEMP\",\n  \"description\": \"Create role as non-admin\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Non-admin Create role should be 403/401', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([401,403]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Roles - Paginated",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/admin/roles?page=0&size=20"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get roles returns 200', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.test('Response has content or is an array', function() {",
                  "    pm.expect(json.content || json.length).to.exist;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Role by ID",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/admin/roles/{{roleId}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get role by id returns 200 or 404 if missing', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Role - Happy Path",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/admin/roles/{{roleId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"description\": \"Updated description - moderation\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Update role attempts returns 200 or 400', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 400, 404]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Delete Role - Has Users (should fail)",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/admin/roles/{{roleId}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Delete role either removes or returns 400 if users exist or ADMIN cannot be deleted', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([204, 400, 403]);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Admin - Permissions",
      "item": [
        {
          "name": "Create Permission",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/admin/permissions",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"content:moderate\",\n  \"description\": \"Moderate user generated content\",\n  \"resource\": \"content\",\n  \"action\": \"moderate\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Create permission returns 201 or 200', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('permissionId', json.id);",
                  "console.log('Saved permissionId');"
                ]
              }
            }
          ]
        },
        {
          "name": "Create Permission - Duplicate",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/admin/permissions",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"content:moderate\",\n  \"description\": \"Duplicate permission test\",\n  \"resource\": \"content\",\n  \"action\": \"moderate\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Create duplicate permission returns 4xx', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 409]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Permissions - Paginated",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/admin/permissions?page=0&size=20"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get permissions returns 200', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Permission by ID",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/admin/permissions/{{permissionId}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get permission by id returns 200 or 404', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Delete Permission - with role attached (should fail or return 400)",
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/admin/permissions/{{permissionId}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Delete permission either 204 or error if assigned to role', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([204, 400, 403]);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Admin - Role \/ Permission Association",
      "item": [
        {
          "name": "Assign Permissions to Role (Bulk)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/admin/roles/{{roleId}}/permissions",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"permissionIds\": [\"{{permissionId}}\"]\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Assign returns 200 or 400/404', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 400, 404]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Role Permissions",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/admin/roles/{{roleId}}/permissions"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get role permissions returns 200 or 404', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Remove Permission from Role",
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/admin/roles/{{roleId}}/permissions/{{permissionId}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Remove permission returns 200 or 404', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Admin - User Role Management",
      "item": [
        {
          "name": "Create User with Role (Admin)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/admin/users",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admincreated\",\n  \"email\": \"admincreated@example.com\",\n  \"password\": \"AdminCreate123\",\n  \"firstName\": \"Admin\",\n  \"lastName\": \"Create\",\n  \"roleIds\": [\"{{roleId}}\"],\n  \"enabled\": true\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Admin created user returns 200 or 201', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200,201]);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('createdUserId', json.id);",
                  "console.log('Saved createdUserId');"
                ]
              }
            }
          ]
        },
        {
          "name": "Create User with invalid role ID (should fail)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/admin/users",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"invalidRoleUser\",\n  \"email\": \"invalidrole@example.com\",\n  \"password\": \"TestPass123\",\n  \"firstName\": \"Invalid\",\n  \"lastName\": \"Role\",\n  \"roleIds\": [\"00000000-0000-0000-0000-000000000000\"],\n  \"enabled\": true\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Create user with invalid role returns 404 or 400', function(){",
                  "    pm.expect(pm.response.code).to.be.oneOf([404, 400]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Assign Roles to User - Bulk",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": "{{baseUrl}}/users/{{createdUserId}}/roles",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"roleIds\": [\"{{roleId}}\"]\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Assign roles returns 200 or 404', function() {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get User Roles",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/users/{{createdUserId}}/roles"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get user roles returns 200 or 404', function() {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Remove Role from User",
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/users/{{createdUserId}}/roles/{{roleId}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Remove role returns 200 or 404', function() {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "OAuth & JWT Tests",
      "item": [
        {
          "name": "Decode User JWT and Check Claims",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{userToken}}" }],
            "url": "{{baseUrl}}/users/me"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get current user 200 or 401 if token invalid', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 401, 403]);",
                  "});",
                  "if(pm.response.code == 200) {",
                  "    // decode JWT",
                  "    var token = pm.collectionVariables.get('userToken');",
                  "    var payload = token.split('.')[1];",
                  "    var jsonPayload = JSON.parse(atob(payload));",
                  "    pm.test('JWT includes userId, username, roles, permissions, authorities', function(){",
                  "        pm.expect(jsonPayload.userId).to.exist;",
                  "        pm.expect(jsonPayload.username).to.exist;",
                  "        pm.expect(jsonPayload.roles).to.be.an('array');",
                  "        pm.expect(jsonPayload.permissions).to.be.an('array');",
                  "        pm.expect(jsonPayload.authorities).to.be.an('array');",
                  "    });",
                  "    console.log(jsonPayload);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Token Introspection - Happy Path",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/x-www-form-urlencoded" }],
            "url": "{{baseUrl}}/oauth/introspect",
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "token", "value": "{{userToken}}" }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Introspect returns active true for valid token', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.active).to.be.a('boolean');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Token Introspection - Invalid/Expired",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/x-www-form-urlencoded" }],
            "url": "{{baseUrl}}/oauth/introspect",
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "token", "value": "invalid-token" }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Introspect invalid token returns active false', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 400]);",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.active).to.be.oneOf([true, false]);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Security / Edge Cases",
      "item": [
        {
          "name": "Non-admin triggers admin endpoints (403)",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{userToken}}" }],
            "url": "{{baseUrl}}/admin/roles"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Non-admin should not access admin endpoints', function() {",
                  "    pm.expect(pm.response.code).to.be.oneOf([403, 401]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Attempt delete ADMIN role (should fail)",
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/admin/roles/{{adminRoleId}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Delete ADMIN role should fail', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 403, 404]);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Attempt self-demotion (remove your own ADMIN role)",
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{adminToken}}" }],
            "url": "{{baseUrl}}/users/{{adminUserId}}/roles/{{adminRoleId}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Self-demotion should be denied', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 403]);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    }
  ],
  "event": [],
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:8081/api/v1", "type": "string" },
    { "key": "adminUsername", "value": "admin", "type": "string" },
    { "key": "adminPassword", "value": "admin123", "type": "string" },
    { "key": "adminToken", "value": "", "type": "string" },
    { "key": "adminRefreshToken", "value": "", "type": "string" },
    { "key": "userToken", "value": "", "type": "string" },
    { "key": "userRefreshToken", "value": "", "type": "string" },
    { "key": "roleId", "value": "", "type": "string" },
    { "key": "permissionId", "value": "", "type": "string" },
    { "key": "userId", "value": "", "type": "string" },
    { "key": "newUserUsername", "value": "testuser", "type": "string" },
    { "key": "newUserPassword", "value": "SecurePass123", "type": "string" },
    { "key": "adminRoleId", "value": "", "type": "string" },
    { "key": "adminUserId", "value": "", "type": "string" },
    { "key": "createdUserId", "value": "", "type": "string" }
  ]
}
